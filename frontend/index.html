<!doctype html>
<html lang=en>
<head>
<meta charset=UTF-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<title>blog</title>
<style>body{font-family:Arial,sans-serif;padding:20px;background-color:#d6d3ce;margin:0;overflow-x:hidden}h1{text-align:center}.message{border-bottom:1px solid #ddd;padding:10px 0;word-wrap:break-word}.author{font-weight:700}.content{margin-left:10px}.timestamp{font-size:.8em;color:gray}.attachments img,.content img{width:10%;height:auto;display:block;margin:5px 0}</style>
</head>
<body>
<div id=messages></div>
<script>function isImageUrl(t){return new Promise((e=>{const n=new Image;n.onload=()=>e(!0),n.onerror=()=>e(!1),n.src=t}))}async function fetchMessages(){try{const t=await fetch("http://localhost:3000/messages");if(!t.ok)throw new Error("Network response was not ok");const e=await t.json(),n=document.getElementById("messages");if(!n)return void console.warn("Messages container not found.");const s=Array.from(n.children).map((t=>t.getAttribute("data-timestamp")));for(const t of e){const e=new Date(t.timestamp).getTime().toString();if(s.includes(e))continue;const a=document.createElement("div");a.classList.add("message"),a.setAttribute("data-timestamp",e),a.innerHTML=`\n                    <span class="author" style="color: ${t.color}">${t.author}:</span>\n                    <span class="content"></span>\n                    <div class="timestamp">${new Date(t.timestamp).toLocaleString()}</div>\n                `;const o=a.querySelector(".content");if(t.content.startsWith("http"))if(await isImageUrl(t.content)){const e=document.createElement("img");e.src=t.content,e.style.width="10%",o.appendChild(e)}else{const e=document.createElement("a");e.href=t.content,e.target="_blank",e.textContent=t.content,o.appendChild(e)}else o.textContent=t.content;if(t.attachments&&t.attachments.length>0){const e=document.createElement("div");e.classList.add("attachments"),t.attachments.forEach((t=>{const n=document.createElement("img");n.src=t,n.style.width="10%",e.appendChild(n)})),a.appendChild(e)}n.prepend(a)}}catch(t){console.error("Fetch error:",t)}}setInterval(fetchMessages,5e3),fetchMessages();</script>
</body>
</html>