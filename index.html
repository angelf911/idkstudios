<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="styles.css" rel="stylesheet" type="text/css" />
  <link rel="apple-touch-icon" sizes="180x180" href="favicon/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon/favicon-16x16.png">
  <link rel="manifest" href="favicon/site.webmanifest">
  <title>idk studios</title>

  <style>
    body {
      font-size: 16px;
    }

    #content {
      width: 99%;
      margin: 2px auto;
      text-align: center;
    }

    #header {
      background-color: #04479b;
    }

    .iframe-container {
      display: flex;
      justify-content: center;
    }

    iframe {
      aspect-ratio: 16 / 9;
      width: 100%;
      border: none;
      margin: 30px;
      background-color: black;

    }

    h2 {
      text-align: center;
      margin-bottom: 6%;
      margin-top: 9%
    }

    .credits {
      text-align: center;
    }

    .news-item {
      margin: 10px 0;
      text-align: center;
    }

    .news-item p {
      margin: 0 0 5px;
      font-size: 14px;
      color: #262435;
    }

    .news-item hr {
  border: 0;
  border-top: 1px solid #b5b4ae;
  width: 100%;
}

    .news-item p strong {
      font-size: 16px;
      font-weight: bold;
      color: #000000;
    }

    .news-item img {
      margin: 10px auto;
      display: block;
      max-width: 100%;
      height: auto;
      width: 20%;
      -webkit-filter: drop-shadow(2px 2px 4px #222);
      transition: transform 0.2s;
    }

    .news-item img:hover {
      transform: scale(0.9);
    }

    .tagline {
      transition: transform 0.2s;
    }

    .tagline:hover {
      transform: scale(.9);
      cursor: pointer;
    }

    .tagline:hover span {
      display: none;
    }

    .tagline:hover:before {
      content: "click on the time to get back home!";
      color: blue;
      transform: scale(1.1);
    }


    @media (max-width: 415px) {
      iframe {
        height: auto;
        width: 250px;
      }
    }
  </style>
</head>

<script>
/* ------------------------------
   Helpers: fetch text/json safely
--------------------------------*/
async function fetchText(path) {
  const res = await fetch(path, { cache: "no-store" });
  if (!res.ok) throw new Error("Failed to fetch " + path);
  return res.text();
}
async function fetchJSON(path) {
  const res = await fetch(path, { cache: "no-store" });
  if (!res.ok) throw new Error("Failed to fetch " + path);
  return res.json();
}

/* ------------------------------
   NEWS: parse news.txt blocks
   Format (you already use):
   ----
   MM/DD/YY
   <description line>
   <imageOrGifUrl | "none">
   <linkUrl | "none">
   ----
--------------------------------*/
function parseNewsTxt(txt) {
  const blocks = txt.split('----').map(s => s.trim()).filter(Boolean);
  const items = [];
  for (const block of blocks) {
    const lines = block.split('\n').map(l => l.trim()).filter(Boolean);
    if (lines.length >= 2) {
      const [date, description, image = "none", link = "none"] = lines;
      items.push({ date, description, image, link });
    }
  }
  // Sort newest first by date (MM/DD/YY)
  items.sort((a, b) => {
    const toDate = (m) => {
      const [mm, dd, yy] = m.date.split('/').map(x => x.trim());
      // resolve year 2-digit -> 20YY
      const fullYear = Number(yy) + 2000;
      return new Date(fullYear, Number(mm) - 1, Number(dd));
    };
    return toDate(b) - toDate(a);
  });
  return items;
}

/* Render News to #news-list */
function renderNews(items) {
  const list = document.getElementById('news-list');
  list.innerHTML = '';
  items.forEach(({ date, description, image, link }) => {
    const wrap = document.createElement('div');
    wrap.className = 'news-item';

    // date (bold)
    const dateP = document.createElement('p');
    dateP.innerHTML = `<strong>${date}</strong>`;
    wrap.appendChild(dateP);

    // description on its own line
    const descP = document.createElement('p');
    descP.textContent = description;
    wrap.appendChild(descP);

    // image (clickable if link)
    if (image && image.toLowerCase() !== 'none') {
      const img = document.createElement('img');
      img.src = image;
      img.alt = description;
      if (link && link.toLowerCase() !== 'none') {
        img.style.cursor = 'pointer';
        img.addEventListener('click', () => window.open(link, '_blank'));
      }
      wrap.appendChild(img);
    } else if (link && link.toLowerCase() !== 'none') {
      const a = document.createElement('a');
      a.href = link;
      a.target = '_blank';
      a.textContent = 'Read more';
      wrap.appendChild(a);
    }

    // the separator line exactly like your layout
    const hr = document.createElement('hr');
    hr.style.marginTop = '18px';
    wrap.appendChild(hr);

    list.appendChild(wrap);
  });
}

/* ------------------------------
   BANNER (bottom news bar)
   banner.txt = one-line marquee text
--------------------------------*/
async function loadBanner() {
  try {
    const text = await fetchText('scripts/banner.txt');
    const el = document.getElementById('news-bar-content');
    el.textContent = text.trim();
  } catch (e) {
    console.warn(e);
  }
}

/* ------------------------------
   YOUTUBE video
   video.json format:
   {
     "mode": "manual" | "latest",
     "manualUrl": "https://www.youtube.com/watch?v=XXXX",
     "channelId": "UCxxxxxxxxxxxx"   // used only if mode=latest
   }
--------------------------------*/
function ytEmbedUrlFromWatch(url) {
  try {
    // accept youtu.be/ID or youtube.com/watch?v=ID
    const u = new URL(url);
    if (u.hostname.includes('youtu.be')) {
      return `https://www.youtube.com/embed/${u.pathname.replace('/', '')}`;
    }
    const id = u.searchParams.get('v');
    return id ? `https://www.youtube.com/embed/${id}` : null;
  } catch {
    return null;
  }
}

async function loadYouTube() {
  const iframe = document.getElementById('youtube-iframe');

  // fallback: your live YouTube logic
  async function fetchLatestFromYouTubeAPI() {
    const channelId = 'UCVkYOlUfjYtLfcHll0tp0Sg';
    const apiKey = 'AIzaSyCIWT_UAbdgkynBkhN8t_imyB5iyLdzEik';
    const url = `https://www.googleapis.com/youtube/v3/search?part=snippet&channelId=${channelId}&maxResults=5&order=date&type=video&key=${apiKey}`;

    try {
      const resp = await fetch(url);
      const data = await resp.json();
      const videoIds = (data.items || [])
        .map(item => item.id && item.id.videoId)
        .filter(Boolean);
      if (!videoIds.length) return;

      const detailsUrl = `https://www.googleapis.com/youtube/v3/videos?part=contentDetails&id=${videoIds.join(',')}&key=${apiKey}`;
      const dresp = await fetch(detailsUrl);
      const vdata = await dresp.json();

      // pick first NOT 20–60 seconds
      let picked = null;
      for (const video of vdata.items || []) {
        const duration = video.contentDetails.duration;
        const match = duration.match(/PT(\d+M)?(\d+S)?/);
        const minutes = parseInt(match?.[1]?.replace('M', '') || 0, 10);
        const seconds = parseInt(match?.[2]?.replace('S', '') || 0, 10);
        const totalSeconds = minutes * 60 + seconds;
        if (totalSeconds < 20 || totalSeconds > 60) {
          picked = video.id;
          break;
        }
      }
      if (!picked) {
        picked = videoIds[0];
      }
      iframe.src = `https://www.youtube.com/embed/${picked}`;
    } catch (err) {
      console.warn('YT API fallback failed:', err);
    }
  }

  try {
    const data = await fetchJSON('video.json');

    // 1) manual wins
    if (data.mode === 'manual' && data.manualUrl) {
      const embed = ytEmbedUrlFromWatch(data.manualUrl);
      if (embed) {
        iframe.src = embed;
        return;
      }
    }

    // 2) latest, but admin already wrote a resolved manualUrl → just use it
    if (data.mode === 'latest') {
      if (data.manualUrl) {
        const embed = ytEmbedUrlFromWatch(data.manualUrl);
        if (embed) {
          iframe.src = embed;
          return;
        }
      }
      // 3) latest, but admin json didn’t have a resolved url → hit YouTube directly
      await fetchLatestFromYouTubeAPI();
      return;
    }

    // 4) anything else → fallback to live YouTube
    await fetchLatestFromYouTubeAPI();

  } catch (e) {
    console.warn(e);
    // couldn’t load video.json → fallback to live YT
    await fetchLatestFromYouTubeAPI();
  }
}


/* ------------------------------
   Boot
--------------------------------*/
(async function init() {
  try {
    // only run once even if another script tries
    if (!window.__IDK_NEWS_RENDERED__) {
      const newsTxt = await fetchText('scripts/news.txt');
      const items = parseNewsTxt(newsTxt);
      renderNews(items);
      window.__IDK_NEWS_RENDERED__ = true;
    }
  } catch (e) {
    console.warn(e);
  }

  loadBanner();
  loadYouTube();
})();


</script>


<body>
  <div id="nav">
    <img src="https://idkstudios.s3.us-east-2.amazonaws.com/images/icons/nav/archiveIcon.png"
      onclick="location.href='archive.html'">
    <img src="https://idkstudios.s3.us-east-2.amazonaws.com/images/icons/nav/channelIcon.gif"
      onclick="window.open('https://www.youtube.com/@idkstudiosorg', '_blank')">
    <img src="https://idkstudios.s3.us-east-2.amazonaws.com/images/icons/nav/blogIcon.png"
      onclick="location.href='blog.html'">
    <img src="https://idkstudios.s3.us-east-2.amazonaws.com/images/icons/nav/radioIcon.png"
      onclick="location.href='radio.html'">
    <img src="https://idkstudios.s3.us-east-2.amazonaws.com/images/icons/nav/aboutIcon.png"
      onclick="location.href='about.html'">
  </div>

  <div id="main-container">
    <div id="main-container-style">
      <div id="header">
        <div class="header-title">
          <img src="https://idkstudios.s3.us-east-2.amazonaws.com/images\icons\page\tree.png" id="winicon">
        </div>
        <h1>home</h1>
        <button onclick="location.href='index.html'" title="Close"><img
            src="https://idkstudios.s3.us-east-2.amazonaws.com/images/icons/page/xButton.png"></button>
      </div>

      <div id="black-bar"></div>

      <div id="main-box">
        <div id="box-bg">
          <div id="content">
            <p class="tagline"><span>we make anything and everything</span></p>
          </div>

          <div class="iframe-container">
            <iframe id="youtube-iframe"
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
              allowfullscreen>
            </iframe>
          </div>

          <div class="news-section">
            <h2 class="news-header"><u>news</u></h2>
            <div id="news-list"></div>
          </div>

          <p class="credits">~ site by <a href="https://odiwr.com" target="_blank">@odiwr</a></p>
        </div>
      </div>
    </div>
  </div>

  <div id="taskbar">
    <div class="start-box">
      <button class="start-button" onclick="location.href='index.html'">idk studios</button>
    </div>

    <div class="news-bar">
      <marquee behavior="scroll" direction="left">
        <div id="news-bar-content"></div>
      </marquee>
    </div>


    <div class="system-tray-icons">
      <div class="system-tray-icon"><img
          src="https://idkstudios.s3.us-east-2.amazonaws.com/images/icons/socials/instagram.png"
          onclick="window.open('https://www.instagram.com/idkstudios_/', '_blank')"></div>
      <div class="system-tray-icon"><img
          src="https://idkstudios.s3.us-east-2.amazonaws.com/images/icons/socials/tiktok.png"
          onclick="window.open('https://www.tiktok.com/@idk.studioss', '_blank')"></div>
      <div class="system-tray-icon"><img
          src="https://idkstudios.s3.us-east-2.amazonaws.com/images/icons/socials/twitter.png"
          onclick="window.open('https://x.com/_idkstudios', '_blank')"></div>
      <div class="system-tray-icon"><img
          src="https://idkstudios.s3.us-east-2.amazonaws.com/images/icons/socials/discord.png"
          onclick="window.open('https://discord.gg/YMzDKmxg4E', '_blank')"></div>
      <div class="system-tray-icon"><img
          src="https://idkstudios.s3.us-east-2.amazonaws.com/images/icons/socials/patreon.png"
          onclick="window.open('https://www.patreon.com/idkstudios_', '_blank')"></div>
    </div>
  </div>

  <script src="https://idkstudios.s3.us-east-2.amazonaws.com/scripts/scripts.js"></script>
</body>

</html>


